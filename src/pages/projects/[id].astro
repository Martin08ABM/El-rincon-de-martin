---
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../lib/supabase";
import CommentBox from "../../components/commentBox.astro";
const { id } = Astro.params;

import { remark } from "remark";
import html from "remark-html";
const postSlug = id; // Using 'id' as the slug for projects

const { data: project, error } = await supabase
  .from("uploadProjects")
  .select("*")
  .eq("id", id)
  .single();

if (error) {
  console.error("Error fetching project:", error.message);
  return Astro.redirect("/404");
}

const processedContent = await remark().use(html).process(project.explanation);
const contentHtml = processedContent.toString();
---

<Layout title={project.title}>
  <main class="p-4 md:p-8 flex-grow">
    <article class="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-6 md:p-8">
      <h1 class="text-3xl md:text-4xl font-bold mb-4">{project.title}</h1>
      
      <img src={project.images} alt={project.title} class="w-full h-auto object-cover mb-6 rounded-lg" />

      <div class="prose max-w-none mb-6" set:html={contentHtml} />

      <a href={project.link} target="_blank" rel="noopener noreferrer" class="text-orange-500 hover:underline font-bold">
        Ver c√≥digo del proyecto
      </a>

      <br />

      <a href="/projects/projects" class="text-orange-500 hover:underline mt-8 inline-block">Volver a Proyectos</a>

      <CommentBox postSlug={postSlug} />
    </article>
  </main>
</Layout>
