---
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../lib/supabase";
import CommentBox from "../../components/commentBox.astro";

import { remark } from "remark";
import html from "remark-html";
const { id } = Astro.params;
const postSlug = id; // Using 'id' as the slug for blog posts

const { data: post, error } = await supabase
  .from("postsBlog")
  .select("*")
  .eq("id", id)
  .single();

if (error) {
  console.error("Error fetching post:", error.message);
  return Astro.redirect("/404");
}

const processedContent = await remark().use(html).process(post.content);
const contentHtml = processedContent.toString();
---

<Layout title={post.title}>
  <main class="p-4 md:p-8 flex-grow">
    <article class="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-6 md:p-8">
      <h1 class="text-3xl md:text-4xl font-bold mb-4">{post.title}</h1>
      <p class="text-gray-600 mb-6">Por: {post.name}</p>
      
      <div class="prose max-w-none" set:html={contentHtml} />

      <a href="/blog/blog" class="text-orange-500 hover:underline mt-8 inline-block">Volver al Blog</a>

      <CommentBox postSlug={postSlug} />
    </article>
  </main>
</Layout>
